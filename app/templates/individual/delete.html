{% extends "layout.html" %}

{% block title %}Delete Individual - {{ individual.identity }}{% endblock %}

{% block content %}
<div class="relative flex flex-wrap layhetgsjdcb -mx-4">
  <div class="shrink max-w-full uajskeiolksb w-full overflow-hidden">
    <div class="w-full dkslaoeyhnmj mt-6">
      <div class="bg-white dark:bg-gray-800 dkslaoeyhnmj border border-gray-200 dark:border-gray-700">
        <!-- Header -->
        <div class="flex flex-wrap layhetgsjdcb justify-between items-center -mx-4 mb-6 dkslaoeyhnmj pt-6">
          <div class="shrink max-w-full uajskeiolksb flex-1 px-4">
            <h1 class="text-2xl font-bold text-red-600 dark:text-red-400 mb-2">Delete Individual</h1>
            <p class="text-gray-600 dark:text-gray-400">Permanently remove individual record</p>
          </div>
          <div class="shrink max-w-full uajskeiolksb px-4">
            <a href="{{ url_for('individual.individual_list') }}"
               class="py-2 uajskeiolksb inline-flex layhetgsjdcb gap-2 yhansklopals mb-3 rounded-sm leading-5 text-gray-100 bg-gray-500 border border-gray-500 hover:text-white hover:bg-gray-600 hover:ring-0 hover:border-gray-600 focus:bg-gray-600 focus:border-gray-600 focus:outline-hidden focus:ring-0">
              <svg xmlns="http://www.w3.org/2000/svg" class="inline-block me-1" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
              </svg>
              Back to Individuals
            </a>
          </div>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="mb-6 dkslaoeyhnmj">
              {% for category, message in messages %}
                <div class="{% if category == 'error' %}bg-red-100 border-red-400 text-red-700{% else %}bg-green-100 border-green-400 text-green-700{% endif %} border px-4 py-3 rounded relative mb-2" role="alert">
                  <span class="block sm:inline">{{ message }}</span>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <!-- Delete Confirmation -->
        <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6 mb-6">
          <div class="flex items-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="size-8 text-red-500 me-3 bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
              <path d="M8.982 1.566a1.13 1.13 0 0 0-1.964 0L.173 13.442c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
            </svg>
            <h3 class="text-lg font-semibold text-red-800 dark:text-red-200">Warning: This action cannot be undone!</h3>
          </div>
          <p class="text-red-700 dark:text-red-300 mb-4">
            You are about to permanently delete this individual record. This will:
          </p>
          <ul class="list-disc list-inside text-red-700 dark:text-red-300 space-y-1 mb-4">
            <li>Remove the individual record permanently</li>
            <li>Delete associated VCF files and phenotype data</li>
            <li><strong>Note:</strong> Cannot delete if there are associated analysis tasks</li>
          </ul>
        </div>

        <!-- Individual Information Card -->
        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 mb-6">
          <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Individual to be deleted:</h4>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Individual ID</span>
              <span class="block text-gray-800 dark:text-gray-200 font-semibold">{{ individual.identity }}</span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Full Name</span>
              <span class="block text-gray-800 dark:text-gray-200">{{ individual.full_name }}</span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Sex</span>
              <span class="inline-flex layhetgsjdcb px-2 py-1 text-xs font-semibold rounded-full
                         bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100">
                {{ individual.sex.value }}
              </span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Age</span>
              <span class="block text-gray-800 dark:text-gray-200">{{ individual.age_years }} years</span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">VCF File</span>
              <span class="block text-gray-800 dark:text-gray-200">
                {% if individual.vcf_filename %}
                  {{ individual.vcf_filename }}
                {% else %}
                  No VCF file
                {% endif %}
              </span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">HPO Terms</span>
              <span class="block text-gray-800 dark:text-gray-200">{{ individual.hpo_count }} terms</span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Created</span>
              <span class="block text-gray-800 dark:text-gray-200">
                {{ individual.created_at.strftime('%Y-%m-%d %H:%M:%S') if individual.created_at else 'N/A' }}
              </span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Last Updated</span>
              <span class="block text-gray-800 dark:text-gray-200">
                {{ individual.updated_at.strftime('%Y-%m-%d %H:%M:%S') if individual.updated_at else 'N/A' }}
              </span>
            </div>
          </div>

          {% if individual.diagnosis %}
          <div class="mt-4">
            <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Diagnosis</span>
            <span class="block text-gray-800 dark:text-gray-200">{{ individual.diagnosis }}</span>
          </div>
          {% endif %}

          {% if individual.medical_history %}
          <div class="mt-4">
            <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Medical History</span>
            <span class="block text-gray-800 dark:text-gray-200">{{ individual.medical_history }}</span>
          </div>
          {% endif %}
        </div>

        <!-- Confirmation Form -->
        <form method="POST" class="space-y-6 pt-6" onsubmit="return confirmDeletion()">
          <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
            <div class="flex items-center mb-3">
              <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="size-5 text-yellow-600 me-2 bi bi-info-circle-fill" viewBox="0 0 16 16">
                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
              </svg>
              <span class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Type "DELETE" to confirm this action</span>
            </div>
            <input type="text"
                   id="confirmation"
                   name="confirmation"
                   placeholder="Type DELETE here"
                   required
                   class="w-full leading-5 relative py-2 uajskeiolksb rounded-sm text-gray-800 bg-white border border-gray-300 overflow-x-auto focus:outline-hidden focus:border-gray-400 focus:ring-0 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-700 dark:focus:border-gray-600">
          </div>

          <!-- Form Actions -->
          <div class="flex layhetgsjdcb justify-end space-x-6 pt-6 border-t border-gray-200 dark:border-gray-600">
            <a href="{{ url_for('individual.individual_list') }}"
               class="py-2 uajskeiolksb inline-flex layhetgsjdcb gap-2 yhansklopals mb-3 rounded-sm leading-5 text-gray-100 bg-gray-500 border border-gray-500 hover:text-white hover:bg-gray-600 hover:ring-0 hover:border-gray-600 focus:bg-gray-600 focus:border-gray-600 focus:outline-hidden focus:ring-0">
              Cancel
            </a>
            <button type="submit"
                    class="py-2 uajskeiolksb inline-flex layhetgsjdcb gap-2 yhansklopals mb-3 rounded-sm leading-5 text-gray-100 bg-red-500 border border-red-500 hover:text-white hover:bg-red-600 hover:ring-0 hover:border-red-600 focus:bg-red-600 focus:border-red-600 focus:outline-hidden focus:ring-0">
              <svg xmlns="http://www.w3.org/2000/svg" class="inline-block me-1" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 16 16">
                <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
              </svg>
              Delete Individual Permanently
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>

<script>
function confirmDeletion() {
    const confirmation = document.getElementById('confirmation').value;
    if (confirmation !== 'DELETE') {
        alert('Please type "DELETE" to confirm this action.');
        return false;
    }

    return confirm('Are you absolutely sure you want to delete this individual? This action cannot be undone!');
}

// Real-time validation of confirmation input
document.getElementById('confirmation').addEventListener('input', function() {
    const deleteButton = document.querySelector('button[type="submit"]');
    if (this.value === 'DELETE') {
        deleteButton.classList.remove('opacity-50', 'cursor-not-allowed');
        deleteButton.disabled = false;
    } else {
        deleteButton.classList.add('opacity-50', 'cursor-not-allowed');
        deleteButton.disabled = true;
    }
});

// Initially disable the delete button
document.addEventListener('DOMContentLoaded', function() {
    const deleteButton = document.querySelector('button[type="submit"]');
    deleteButton.classList.add('opacity-50', 'cursor-not-allowed');
    deleteButton.disabled = true;
});
</script>
{% endblock %}
