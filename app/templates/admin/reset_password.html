{% extends "layout.html" %}

{% block title %}Reset Password - {{ user_to_reset.full_name or user_to_reset.email }}{% endblock %}

{% block content %}
<div class="relative flex flex-wrap layhetgsjdcb -mx-4">
  <div class="shrink max-w-full uajskeiolksb w-full overflow-hidden">
    <div class="w-full dkslaoeyhnmj mt-6">
      <div class="bg-white dark:bg-gray-800 dkslaoeyhnmj border border-gray-200 dark:border-gray-700">
        <!-- Header -->
        <div class="flex flex-wrap layhetgsjdcb justify-between items-center -mx-4 mb-6 dkslaoeyhnmj pt-6">
          <div class="shrink max-w-full uajskeiolksb flex-1 px-4">
            <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-300 mb-2">Reset Password</h1>
            <p class="text-gray-600 dark:text-gray-400">Reset password for: {{ user_to_reset.email }}</p>
          </div>
          <div class="shrink max-w-full uajskeiolksb px-4">
            <a href="{{ url_for('routes.admin_users') }}"
               class="py-2 uajskeiolksb inline-flex layhetgsjdcb gap-2 yhansklopals mb-3 rounded-sm leading-5 text-gray-100 bg-gray-500 border border-gray-500 hover:text-white hover:bg-gray-600 hover:ring-0 hover:border-gray-600 focus:bg-gray-600 focus:border-gray-600 focus:outline-hidden focus:ring-0">
              <svg xmlns="http://www.w3.org/2000/svg" class="inline-block me-1" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
              </svg>
              Back to Users
            </a>
          </div>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="mb-6 dkslaoeyhnmj">
              {% for category, message in messages %}
                <div class="{% if category == 'error' %}bg-red-100 border-red-400 text-red-700{% else %}bg-green-100 border-green-400 text-green-700{% endif %} border px-4 py-3 rounded relative mb-2" role="alert">
                  <span class="block sm:inline">{{ message }}</span>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <!-- User Information Card -->
        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 mb-6">
          <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">User Information:</h4>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Email</span>
              <span class="block text-gray-800 dark:text-gray-200">{{ user_to_reset.email }}</span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Full Name</span>
              <span class="block text-gray-800 dark:text-gray-200">{{ user_to_reset.full_name or 'Not set' }}</span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Status</span>
              <span class="inline-flex layhetgsjdcb px-2 py-1 text-xs font-semibold rounded-full
                         {% if user_to_reset.is_active %}bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100{% else %}bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100{% endif %}">
                {{ 'Active' if user_to_reset.is_active else 'Inactive' }}
              </span>
            </div>

            <div>
              <span class="block text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Role</span>
              <span class="inline-flex layhetgsjdcb px-2 py-1 text-xs font-semibold rounded-full
                         {% if user_to_reset.is_admin %}bg-purple-100 text-purple-800 dark:bg-purple-800 dark:text-purple-100{% else %}bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100{% endif %}">
                {{ 'Administrator' if user_to_reset.is_admin else 'User' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Password Reset Form -->
        <form method="POST" class="space-y-6 pt-6">
          <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-6">
            <div class="flex items-center mb-3">
              <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="size-5 text-yellow-600 me-2 bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.964 0L.173 13.442c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
              </svg>
              <span class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Security Notice</span>
            </div>
            <p class="text-sm text-yellow-700 dark:text-yellow-300">
              This action will reset the user's password. The user will need to use the new password to log in.
              {% if user_to_reset.id == current_user.id %}
                <strong>Note:</strong> You are resetting your own password.
              {% endif %}
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- New Password -->
            <div>
              <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                New Password *
              </label>
              <input type="password"
                     id="password"
                     name="password"
                     required
                     minlength="6"
                     class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-hidden focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300"
                     placeholder="Enter new password (min 6 characters)">
            </div>

            <!-- Confirm New Password -->
            <div>
              <label for="confirm_password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Confirm New Password *
              </label>
              <input type="password"
                     id="confirm_password"
                     name="confirm_password"
                     required
                     minlength="6"
                     class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-hidden focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300"
                     placeholder="Confirm new password">
            </div>
          </div>

          <!-- Password Requirements -->
          <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
            <h4 class="text-sm font-medium text-blue-800 dark:text-blue-200 mb-2">Password Requirements:</h4>
            <ul class="text-sm text-blue-700 dark:text-blue-300 space-y-1">
              <li>• Minimum 6 characters long</li>
              <li>• Use a strong password for better security</li>
              <li>• Avoid using common passwords or personal information</li>
            </ul>
          </div>

          <!-- Additional Options -->
          <div class="space-y-4">
            <div class="flex items-center">
              <input type="checkbox"
                     id="notify_user"
                     name="notify_user"
                     value="1"
                     class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
              <label for="notify_user" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                Notify user via email about password reset (if email system is configured)
              </label>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex layhetgsjdcb justify-end space-x-6 pt-6 border-t border-gray-200 dark:border-gray-600">
            <a href="{{ url_for('routes.admin_users') }}"
               class="py-2 uajskeiolksb inline-flex layhetgsjdcb gap-2 yhansklopals mb-3 rounded-sm leading-5 text-gray-100 bg-gray-500 border border-gray-500 hover:text-white hover:bg-gray-600 hover:ring-0 hover:border-gray-600 focus:bg-gray-600 focus:border-gray-600 focus:outline-hidden focus:ring-0">
              Cancel
            </a>
            <button type="submit"
                    class="py-2 uajskeiolksb inline-flex layhetgsjdcb gap-2 yhansklopals mb-3 rounded-sm leading-5 text-gray-100 bg-orange-500 border border-orange-500 hover:text-white hover:bg-orange-600 hover:ring-0 hover:border-orange-600 focus:bg-orange-600 focus:border-orange-600 focus:outline-hidden focus:ring-0">
              <svg xmlns="http://www.w3.org/2000/svg" class="inline-block me-1" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 16 16">
                <path d="M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14L15.5 8 14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2zM2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
              </svg>
              Reset Password
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>

<script>
// Password confirmation validation
document.getElementById('confirm_password').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    const confirmPassword = this.value;

    if (password !== confirmPassword) {
        this.setCustomValidity('Passwords do not match');
    } else {
        this.setCustomValidity('');
    }
});

document.getElementById('password').addEventListener('input', function() {
    const confirmPassword = document.getElementById('confirm_password');
    if (confirmPassword.value && this.value !== confirmPassword.value) {
        confirmPassword.setCustomValidity('Passwords do not match');
    } else {
        confirmPassword.setCustomValidity('');
    }
});
</script>
{% endblock %}
