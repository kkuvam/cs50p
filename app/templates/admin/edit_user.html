{% extends "layout.html" %}

{% block title %}Edit User - {{ user_to_edit.full_name or user_to_edit.email }}{% endblock %}

{% block content %}
<div class="relative flex flex-wrap layhetgsjdcb -mx-4">
  <div class="shrink max-w-full uajskeiolksb w-full overflow-hidden">
    <div class="w-full dkslaoeyhnmj mt-6">
      <div class="bg-white dark:bg-gray-800 dkslaoeyhnmj border border-gray-200 dark:border-gray-700">
        <!-- Header -->
        <div class="flex flex-wrap layhetgsjdcb justify-between items-center -mx-4 mb-6 dkslaoeyhnmj pt-6">
          <div class="shrink max-w-full uajskeiolksb flex-1 px-4">
            <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-300 mb-2">Edit User</h1>
            <p class="text-gray-600 dark:text-gray-400">Modify user account: {{ user_to_edit.email }}</p>
          </div>
          <div class="shrink max-w-full uajskeiolksb px-4">
            <a href="{{ url_for('routes.admin_users') }}"
               class="py-2 uajskeiolksb inline-flex layhetgsjdcb gap-2 yhansklopals mb-3 rounded-sm leading-5 text-gray-100 bg-gray-500 border border-gray-500 hover:text-white hover:bg-gray-600 hover:ring-0 hover:border-gray-600 focus:bg-gray-600 focus:border-gray-600 focus:outline-hidden focus:ring-0">
              <svg xmlns="http://www.w3.org/2000/svg" class="inline-block me-1" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
              </svg>
              Back to Users
            </a>
          </div>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="mb-6 dkslaoeyhnmj">
              {% for category, message in messages %}
                <div class="{% if category == 'error' %}bg-red-100 border-red-400 text-red-700{% else %}bg-green-100 border-green-400 text-green-700{% endif %} border px-4 py-3 rounded relative mb-2" role="alert">
                  <span class="block sm:inline">{{ message }}</span>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <!-- Edit User Form -->
        <form method="POST" class="space-y-6 pt-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <!-- Email -->
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Email Address *
              </label>
              <input type="email"
                     id="email"
                     name="email"
                     required
                     value="{{ request.form.get('email', user_to_edit.email) }}"
                     class="w-full leading-5 relative py-2 uajskeiolksb rounded-sm text-gray-800 bg-white border border-gray-300 overflow-x-auto focus:outline-hidden focus:border-gray-400 focus:ring-0 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-700 dark:focus:border-gray-600"
                     placeholder="user@example.com">
            </div>

            <!-- Full Name -->
            <div>
              <label for="full_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Full Name
              </label>
              <input type="text"
                     id="full_name"
                     name="full_name"
                     value="{{ request.form.get('full_name', user_to_edit.full_name or '') }}"
                     class="w-full leading-5 relative py-2 uajskeiolksb rounded-sm text-gray-800 bg-white border border-gray-300 overflow-x-auto focus:outline-hidden focus:border-gray-400 focus:ring-0 dark:text-gray-300 dark:bg-gray-700 dark:border-gray-700 dark:focus:border-gray-600"
                     placeholder="John Doe">
            </div>
          </div>

          <!-- Password Management Notice -->
          <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="size-5 text-blue-600 me-2 bi bi-info-circle-fill" viewBox="0 0 16 16">
                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
              </svg>
              <span class="text-sm text-blue-800 dark:text-blue-200">
                <strong>Password Management:</strong> To change this user's password, use the "Reset Password" button on the user list page.
              </span>
            </div>
          </div>          <!-- User Permissions -->
          <div class="space-y-4">
            <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300">User Permissions</h3>

            <div class="flex items-center">
              <input type="checkbox"
                     id="is_active"
                     name="is_active"
                     value="1"
                     {% if request.form.get('is_active') or (not request.form and user_to_edit.is_active) %}checked{% endif %}
                     {% if user_to_edit.id == current_user.id %}disabled{% endif %}
                     class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
              <label for="is_active" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                Active User (can log in)
                {% if user_to_edit.id == current_user.id %}
                  <span class="text-sm text-gray-500">(cannot modify your own status)</span>
                {% endif %}
              </label>
            </div>

            <div class="flex items-center">
              <input type="checkbox"
                     id="is_admin"
                     name="is_admin"
                     value="1"
                     {% if request.form.get('is_admin') or (not request.form and user_to_edit.is_admin) %}checked{% endif %}
                     {% if user_to_edit.id == current_user.id %}disabled{% endif %}
                     class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
              <label for="is_admin" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                Administrator (full system access)
                {% if user_to_edit.id == current_user.id %}
                  <span class="text-sm text-gray-500">(cannot modify your own admin status)</span>
                {% endif %}
              </label>
            </div>
          </div>

          <!-- Account Information -->
          <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-md">
            <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Account Information</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600 dark:text-gray-400">
              <div>
                <span class="font-medium">Created:</span>
                {{ user_to_edit.created_at.strftime('%Y-%m-%d %H:%M:%S') if user_to_edit.created_at else 'N/A' }}
              </div>
              <div>
                <span class="font-medium">Last Updated:</span>
                {{ user_to_edit.updated_at.strftime('%Y-%m-%d %H:%M:%S') if user_to_edit.updated_at else 'N/A' }}
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex layhetgsjdcb justify-end space-x-6 pt-6 border-t border-gray-200 dark:border-gray-600">
            <a href="{{ url_for('routes.admin_users') }}"
               class="py-2 uajskeiolksb inline-flex layhetgsjdcb gap-2 yhansklopals mb-3 rounded-sm leading-5 text-gray-100 bg-gray-500 border border-gray-500 hover:text-white hover:bg-gray-600 hover:ring-0 hover:border-gray-600 focus:bg-gray-600 focus:border-gray-600 focus:outline-hidden focus:ring-0">
              Cancel
            </a>
            <button type="submit"
                    class="py-2 uajskeiolksb inline-flex layhetgsjdcb gap-2 yhansklopals mb-3 rounded-sm leading-5 text-gray-100 bg-indigo-500 border border-indigo-500 hover:text-white hover:bg-indigo-600 hover:ring-0 hover:border-indigo-600 focus:bg-indigo-600 focus:border-indigo-600 focus:outline-hidden focus:ring-0">
              <svg xmlns="http://www.w3.org/2000/svg" class="inline-block me-1" width="1.5rem" height="1.5rem" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L12.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                <path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
              </svg>
              Update User
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>
{% endblock %}
